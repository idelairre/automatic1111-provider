<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>ComfyUI Provider Test - Sgt. Motoko</title>
      <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .status {
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            font-weight: bold;
        }
        .status.loading {
            background: #e3f2fd;
            color: #1976d2;
            border: 1px solid #bbdefb;
        }
        .status.success {
            background: #e8f5e8;
            color: #2e7d32;
            border: 1px solid #c8e6c9;
        }
        .status.error {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ffcdd2;
        }
        .image-container {
            text-align: center;
            margin: 20px 0;
        }
        img {
            max-width: 100%;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .details {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 14px;
        }
        button {
            background: #1976d2;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
        }
        button:hover {
            background: #1565c0;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border-left: 4px solid #1976d2;
        }
    </style>
   </head>
   <body>
      <div class="container">
         <h1>üöÄ ComfyUI Provider Test</h1>

         <div class="info">
            <strong>üéØ Test Case:</strong> Generate Sgt. Motoko from Ghost in
            the Shell: SAC<br>
            <strong>üé® Model:</strong> illustriousXL<br>
            <strong>‚öôÔ∏è Provider:</strong> ComfyUI (localhost:8188)
         </div>

         <div id="status" class="status">
            üîÑ Ready to generate image. Make sure ComfyUI is running on port
            8188.
         </div>

         <button id="generateBtn" onclick="generateImage()">üé® Generate Sgt.
            Motoko Image</button>

         <div id="imageContainer" class="image-container"
            style="display: none;">
            <h3>üì∏ Generated Image:</h3>
            <img id="generatedImage" alt="Generated Sgt. Motoko image" />
            <div class="details" id="imageDetails"></div>
         </div>

         <div class="details">
            <strong>Prompt:</strong><br>
            Highly detailed, photorealistic portrait of Major Motoko Kusanagi
            (Sgt. Motoko) from Ghost in the Shell: Standalone Complex, cyberpunk
            cyborg woman with long black hair, green eyes, pale skin, wearing a
            tight black cybernetic bodysuit, detailed mechanical cybernetic
            enhancements visible on neck and arms, urban cyberpunk background
            with neon lights and holographic displays, intricate details on
            clothing and skin textures, professional digital art, high
            resolution, cinematic lighting, sharp focus, masterpiece quality
         </div>
      </div>

      <script type="module">
        // This would need to be run in a Node.js environment with proper bundling
        // For browser testing, you'd need to bundle the ComfyUI provider and AI SDK
        // This is a demonstration of the API usage pattern

        window.generateImage = async function() {
            const statusDiv = document.getElementById('status');
            const generateBtn = document.getElementById('generateBtn');
            const imageContainer = document.getElementById('imageContainer');
            const generatedImage = document.getElementById('generatedImage');
            const imageDetails = document.getElementById('imageDetails');

            try {
                generateBtn.disabled = true;
                statusDiv.className = 'status loading';
                statusDiv.textContent = 'üé® Generating image... This may take a few minutes.';

                // Note: This would require bundling for browser use
                // In a real implementation, you'd import:
                // import { comfyUIProvider } from 'comfyui-provider';
                // import { experimental_generateImage as generateImage } from 'ai';

                const result = await generateImage({
                    model: comfyUIProvider.image('illustriousXL'),
                    prompt: `Highly detailed, photorealistic portrait of Major Motoko Kusanagi (Sgt. Motoko) from Ghost in the Shell: Standalone Complex, cyberpunk cyborg woman with long black hair, green eyes, pale skin, wearing a tight black cybernetic bodysuit, detailed mechanical cybernetic enhancements visible on neck and arms, urban cyberpunk background with neon lights and holographic displays, intricate details on clothing and skin textures, professional digital art, high resolution, cinematic lighting, sharp focus, masterpiece quality`,
                    n: 1,
                    size: '1024x1024',
                    providerOptions: {
                        comfyui: {
                            negativePrompt: 'blurry, low quality, deformed, ugly, extra limbs, bad anatomy, watermark, text, signature',
                            steps: 40,
                            cfgScale: 8.5,
                            sampler: 'euler_ancestral',
                            checkModelExists: true,
                        },
                    },
                });

                // Convert Uint8Array to blob URL for display
                const blob = new Blob([result.images[0].uint8Array], { type: 'image/png' });
                const imageUrl = URL.createObjectURL(blob);

                generatedImage.src = imageUrl;
                imageContainer.style.display = 'block';

                imageDetails.textContent = `Generated: ${new Date().toLocaleString()}
Size: ${result.images[0].uint8Array.length} bytes
Warnings: ${result.warnings.length > 0 ? result.warnings.map(w => w.details).join(', ') : 'None'}`;

                statusDiv.className = 'status success';
                statusDiv.textContent = '‚úÖ Image generation successful!';

            } catch (error) {
                console.error('Generation error:', error);
                statusDiv.className = 'status error';
                statusDiv.textContent = `‚ùå Error: ${error.message}`;

                if (error.message.includes('model') || error.message.includes('fetch')) {
                    statusDiv.innerHTML += '<br><br><strong>üí° Troubleshooting:</strong><br>' +
                        '1. Ensure ComfyUI is running on port 8188<br>' +
                        '2. Verify "illustriousXL" model is installed<br>' +
                        '3. Check CORS settings for browser access<br>' +
                        '4. Try the Node.js version instead: <code>npm run test-app</code>';
                }
            } finally {
                generateBtn.disabled = false;
            }
        };

        // Show initial status
        document.getElementById('status').innerHTML =
            'üîÑ <strong>Note:</strong> This HTML demo shows the API pattern. ' +
            'For actual image generation, use the Node.js version: <code>npm run test-app</code>';
    </script>
   </body>
</html>
